<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>민감사건 체크리스트 완전판</title>
  <style>
  /* --- 기존 스타일 유지(요청대로 모든 것은 동일) --- */
  body { font-family: sans-serif; padding: 1rem; background-color: #f7f7f7; }
  .section { margin-bottom: 2rem; background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  button { display: block; margin: 0.5rem 0; padding: 0.5rem 1rem; cursor: pointer; }
  .sub-content { margin-left: 1rem; margin-top: 0.5rem; background: #eef; padding: 0.5rem; border-radius: 4px; }

  ul, li {
    list-style-type: none !important;
    margin: 0;
    padding: 0;
  }

  li::before {
    content: none !important;
  }

  li::marker {
    content: none !important;
  }

  .highlight { color: blue; font-weight: bold; }

  /* --- 모달(문서 미리보기 / 다운로드) 스타일 --- */
  .doc-modal {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1200;
    background: rgba(0,0,0,0.45);
  }
  .doc-modal.open { display: flex; }
  .doc-modal .box {
    width: 90%;
    max-width: 980px;
    height: 85%;
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .doc-modal .header {
    padding: 0.6rem 1rem;
    border-bottom: 1px solid #eee;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
  }
  .doc-modal .header .title { font-weight:600; }
  .doc-modal .header .actions { display:flex; gap:8px; align-items:center; }
  .doc-modal .content {
    flex:1;
    background:#fafafa;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:auto;
    padding:8px;
  }
  .doc-modal iframe, .doc-modal embed {
    width:100%;
    height:100%;
    border:0;
  }
  .doc-modal .notice {
    padding: 1rem;
    text-align: center;
    color: #333;
  }
  .link-button {
    border: 1px solid #ccc;
    background: #f6f6f6;
    padding: 0.4rem 0.7rem;
    border-radius: 6px;
    cursor:pointer;
    text-decoration: none;
    color: #111;
  }
  .hidden { display:none; }
  </style>
</head>
<body>

<div class="section">
  <h2>1. 사건 선택</h2>
  <label><input type="radio" name="사건" value="아동학대"> 아동학대</label>
  <label><input type="radio" name="사건" value="가정폭력"> 가정폭력</label>
  <label><input type="radio" name="사건" value="스토킹"> 스토킹</label>
  <label><input type="radio" name="사건" value="교제폭력"> 교제폭력</label>
</div>

<div class="section hidden" id="세부항목섹션">
  <h2>2. 절차 세부 항목</h2>
  <div id="세부항목버튼영역"></div>
</div>

<div class="section" id="필수서류섹션">
  <h2>3. 지구대 사건 접수 시 필수 서류</h2>
  <div id="필수서류버튼영역">
    <button data-항목="필수서류">필수서류</button>
    <button data-항목="유의사항">유의사항</button>
  </div>
</div>

<!-- 문서 미리보기 / 다운로드 모달 -->
<div id="docModal" class="doc-modal" role="dialog" aria-hidden="true">
  <div class="box" role="document">
    <div class="header">
      <div class="title" id="docTitle">문서</div>
      <div class="actions">
        <a id="docDownload" class="link-button" href="#" download>다운로드</a>
        <button id="docClose" class="link-button">닫기</button>
      </div>
    </div>
    <div class="content" id="docContent">
      <!-- PDF iframe/embed 또는 안내문이 여기에 들어감 -->
      <div class="notice" id="docNotice">문서를 불러오는 중입니다...</div>
    </div>
  </div>
</div>

<script>
function 색상변환(text) {
  return text
    .replace(/\|\|\|(.+?)\|\|\|/g, '<span style="color: green; font-weight: bold;">$1</span>')
    .replace(/\|\|(.+?)\|\|/g, '<span style="color: blue; font-weight: bold;">$1</span>')
    .replace(/\|(.+?)\|/g, '<span style="color: red; font-weight: bold;">$1</span>');
}

/* --- 기존 데이터(원본 그대로 유지) --- */
const 세부내용Depth = {
  "아동학대": {
    "현장출동": [
      { text: "□ 분리 및 조사", depth: 0 },
      { text: "□ |유의 사항|", depth: 0 },
      { text: "▸|18세 미만| '||아동||' 여부(|||고3 학생 일부 해당 안됨|||)", depth: 1 },
      { text: "▸'아동학대'란 ||보호자|| |||및||| ||성인||에 의한 학대", depth: 1 },
      { text: "□ ||아동학대 현장조사 체크리스트 작성||", depth: 0 }
    ],
    "응급조치(||경찰|| or ||전담공무원||)": [
      { text: "□ 보호자에 의한 아동학대 여부 검토", depth: 0 },
      { text: "▸|보호자 아닌 ||기타 성인||에 의한 학대인 경우| ||응급조치 및 긴급임시조치|| 등 |해당사항 없음|", depth: 1 },
      { text: "□ 아동학대범죄 ||현장||을 발견한 경우 또는 ||학대현장 이외의 장소에서 학대피해가 확인되고 재학대의 위험이 급박ㆍ현저한 경우||", depth: 0 },
      { text: "▸1호: 아동학대범죄 행위의 ||제지||", depth: 1 },
      { text: "▸2호: 아동학대행위자를 피해아동으로부터 ||격리||", depth: 1 },
      { text: "▸3호: 피해아동을 아동학대 관련 ||보호시설로 인도||", depth: 1 },
      { text: "▸4호: 긴급치료가 필요한 피해아동을 ||의료기관으로 인도||", depth: 1 },
      { text: "▸5호: 피해아동등을 ||연고자 등에게 인도||", depth: 1 },
      { text: "□ 응급조치결과 보고서 작성", depth: 0 },
      { text: "□ |사후신청| ||의무|| |있음|(여청수사)", depth: 0 },
      { text: "▸||응급조치(2~5호)||시 |지체|없이 검사에게 ||임시조치의 청구를 신청||해야한다 ", depth: 1 },
    ],
     "긴급임시조치(||경찰||)": [
      { text: "□ 응급조치에도 불구 ||아동학대범죄 재발 우려||가 있고 ||긴급||을 요할때 |경찰직권| or |피해아동 등의 신청|에 따라", depth: 0 },
      { text: "▸1호: 피해아동 또는 가정구성원의 ||주거로부터 퇴거 등 격리||", depth: 1 },
      { text: "▸2호: 피해아동 또는 가정구성원의 주거, 학교 또는 보호시설 등에서 ||100미터 이내의 접근 금지||", depth: 1 },
      { text: "▸3호: 피해아동 또는 가정구성원에 대한 ||전기통신을 이용한 접근 금지||", depth: 1 },
      { text: "□ ||긴급임시조치결정서 작성||(|사법경찰관|)", depth: 0 },
      { text: "▸ ||긴급임시조치통보서 작성||(긴급임시조치고지 서명-날인거부)(|사법경찰관|)", depth: 1 },
      { text: "※|||긴급임시조치결정서 작성|||하면 오른쪽 |||관련서식|||에 ||긴급임시조치통보서|| |||활성화됨|||", depth: 2 },
      { text: "※|||시ㆍ도지사 또는 시장ㆍ군수ㆍ구청장에게||| |지체 없이| 긴급임시조치 사실 |||통지|||(여성수사)", depth: 2 }, 
      { text: "□ 긴급임시조치 |위반시|", depth: 0 },
      { text: "▸ 경찰서 ||여성보호계||에 |||긴급임시조치위반자 통보서||| 발송 (지구대-offline)", depth: 1 },
      { text: "※ 남부지방법원 형사과에 위반사실 통보(경찰서 여성보호계)", depth: 2 },
      { text: "※ 남부지방법원 형사과(fax 02-2642-7862)", depth: 2 },
      { text: "▸1000만원 이하 ||과태료||", depth: 1 },
      { text: "□ |사후신청| ||의무|| |있음|(여청수사)", depth: 0 },
      { text: "▸||긴급임시조치를 한 경우|| |지체|없이 검사에게 ||임시조치의 청구를 신청||해야한다 ", depth: 1 },
      { text: "□ 긴급임시조치 취소(여청수사)", depth: 0 },
      { text: "▸||검사가 임시조치를 청구하지 아니||하거나 ||법원이 임지조치의 결정을 하지 아니한때|| |즉시| 긴급임시조치를 |취소|해야 한다 ", depth: 1 },
    ],
     "임시조치 |신청|(||경찰||)": [
      { text: "▸응급조치 제2호~제4호 실시 or 긴급임시조치 실시 한 경우 검사에게 임시조치의 청구를 신청함", depth: 0 },
    ],
     "임시조치 |청구|(||검사||)": [
      { text: "▸아동학대범죄가 재발될 우려가 있다고 인정하는 경우 |직권| 또는 |사법경찰관의 신청|에 따라", depth: 1 },
    ],
    "임시조치 결정(||법원||)": [
      { text: "□ 판사 결정으로 다음 조치", depth: 0 },
      { text: "▸1호: 퇴거 등 격리", depth: 1 },
      { text: "▸2호: 접근 금지", depth: 1 },
      { text: "▸3호: 통신 금지", depth: 1 },
      { text: "▸4호: 친권 또는 후견인 권한 행사의 제한 또는 정지", depth: 1 },
      { text: "▸4호: 아동보호전문기관 등에의 상담 및 교육 위탁", depth: 1 },
      { text: "▸6호: 의료기관이나 그 밖의 요양시설에의 위탁", depth: 1 },
      { text: "▸7호: 경찰관서의 유치장 또는 구치소에의 유치", depth: 1 },
      { text: "□ 임시조치 |위반시|", depth: 0 },
      { text: "▸2년 이하의 ||징역|| 또는 2천만원 이하의 ||벌금||", depth: 1 },  
    ],
    "필수서류": [
      { text: "▸||아동학대 현장조사 체크리스트||", depth: 0 },
      { text: "▸||응급조치 보고서||", depth: 0 },
      { text: "▸||긴급임시조치결정서||", depth: 0 },
      { text: "▸||긴급임시조치통보서||", depth: 0 },
      { text: "▸||체포서|| or ||임의동행보고서|| or ||발생보고서||", depth: 0 }
    ],
    "유의사항": [
      { text: "?", depth: 0 },
      { text: "?", depth: 1 },
      { text: "?", depth: 1 }
    ]
  },

  "가정폭력": {
    "현장출동": [
      { text: "□ 가해자와 피해자 분리", depth: 0 },
      { text: "□ 진술 및 증거 확보", depth: 0 },
      { text: "□ |가족 구성원 여부| 확인", depth: 0 },
      { text: "▸배우자(사실상 혼인관계에 있는 사람을 포함한다. 이하 같다) 또는 배우자였던 사람", depth: 1 },
      { text: "▸자기 또는 배우자와 ||직계존비속||관계(사실상의 양친자관계를 포함한다. 이하 같다)에 있거나 있었던 사람", depth: 1 },
      { text: "▸계부모와 자녀의 관계 또는 적모(적모)와 서자(서자)의 관계에 있거나 있었던 사람", depth: 1 },
      { text: "▸|동거|하는 ||친족||", depth: 1 },
      { text: "□ 긴급임시 긴급응급조치 ||통합판단조사표 작성|| 및 ||가정폭력 피해자 권리 및 지원 안내서||", depth: 0 },
      { text: "□ (법률혼 관계 아닌 경우) ||사실혼 판단 체크리스트||(|||서면|||)", depth: 0 }
    ],
    "응급조치(||경찰||)": [
      { text: "□ 진행 중인 가정폭력범죄에 대하여 현장에서 즉시 응급조치", depth: 0 },
      { text: "▸1호: 폭력행위의 ||제지||, 가정폭력행위자ㆍ피해자의 ||분리||", depth: 1 },
      { text: "▸1의2호: 현행범인 ||체포 등 범죄수사||", depth: 1 },
      { text: "▸2호: 피해자를 가정폭력 관련 ||상담소 또는 보호시설로 인도||(|피해자가 동의한 경우|만 해당한다)", depth: 1 },
      { text: "▸3호: 긴급치료가 필요한 피해자를 ||의료기관으로 인도||", depth: 1 },
      { text: "▸4호: 폭력행위 재발 시 ||임시조치 신청 가능 통보||", depth: 1 },
      { text: "▸5호: ||피해자보호명령 또는 신변안전조치 청구 가능 고지||", depth: 1 },
      { text: "□ ||응급조치 보고서 작성||", depth: 0 },
      { text: "□ |사후신청| ||의무|| |없음|", depth: 0 },
    ],
    "긴급임시조치(||경찰||)": [
      { text: "□ ||응급조치에도 불구||하고 가정폭력범죄가 ||재발될 우려||가 있고, ||긴급||을 요할때 |직권| 또는 |피해자/대리인 신청|에 따라", depth: 0 },
      { text: "▸1호: 피해자 또는 가정구성원의 주거 또는 점유하는 방실(방실)로부터의 ||퇴거 등 격리||", depth: 1 },
      { text: "▸2호: 피해자 또는 가정구성원이나 그 주거, 직장 등에서 100미터 이내의 ||접근 금지||", depth: 1 },
      { text: "▸3호: 피해자 또는 가정구성원에 대한 「전기통신기본법」 제2조제1호의 ||전기통신을 이용한 접근 금지||", depth: 1 },
      { text: "□ ||긴급임시조치결정서 작성||(|사법경찰관|)", depth: 0 },
      { text: "▸긴급임시조치 ||통보서||(|||가정폭력행위자 에게 교부|||)", depth: 1 },
      { text: "▸긴급임시조치 ||확인서||(|||가정폭력행위자 확인 서명, 수사서류에 첨부|||)", depth: 1 },
      { text: "※긴급임시조치 확인서 및 통보서는 한장으로 되어 있음(절취하여 통보서 가해자에게 교부)", depth: 2 },
      { text: "※확인서 날인거부시 수사보고 첨부", depth: 2 },
       { text: "□ 긴급임시조치 |위반시|", depth: 0 },
      { text: "▸ 경찰서 ||여성보호계||에 |||긴급임시조치위반자 통보서||| 발송 (지구대-offline)", depth: 1 },
      { text: "※ 남부지방법원 형사과에 위반사실 통보(경찰서 여성보호계)", depth: 2 },
      { text: "※ 남부지방법원 형사과(fax 02-2642-7862)", depth: 2 },
      { text: "▸ 300만원 이하 ||과태료||", depth: 1 },
      { text: "□ |사후신청| ||의무|| |있음|(여청수사)", depth: 0 },
      { text: "▸||긴급임시조치를 한 때에는|| |지체| 없이 검사에게 임시조치를 신청", depth: 1 },
      { text: "□ 긴급임시조치 취소(여청수사)", depth: 0 },
      { text: "▸||검사가 임시조치를 청구하지 아니||하거나 ||법원이 임지조치의 결정을 하지 아니한때|| |즉시| 긴급임시조치를 |취소|해야 한다 ", depth: 1 },     
    ],
    "임시조치 신청(||경찰||)": [
      { text: "▸사법경찰관이 긴급임시조치를 한 때에는 |지체| 없이 검사에게 임시조치를 신청", depth: 0 },
    ],
     "임시조치 청구(||검사||)": [
      { text: "▸법원에 임시조치 청구", depth: 0 },
    ],    

    "임시조치 결정(||법원||)": [
      { text: "□ 결정 내용", depth: 0 },
      { text: "▸1호: 피해자 또는 가정구성원의 주거 또는 점유하는 방실로부터의 ||퇴거 등 격리||", depth: 1 },
      { text: "▸2호: 피해자 또는 가정구성원이나 그 주거ㆍ직장 등에서 100미터 이내의 ||접근 금지||", depth: 1 },
      { text: "▸3호: 피해자 또는 가정구성원에 대한 ||전기통신을 이용한 접근 금지||", depth: 1 },
      { text: "▸4호: ||의료기관이나 그 밖의 요양소에의 위탁||", depth: 1 },
      { text: "▸5호: 국가경찰관서의 ||유치장 또는 구치소에의 유치||(1~3호 위반시)", depth: 1 },
      { text: "▸6호: 상담소등에의 ||상담위탁||", depth: 1 },
      { text: "□ 위반시", depth: 0 },
      { text: "▸1년 이하 ||징역|| 또는 1천만원 이하 ||벌금||", depth: 1 },
    ],

    "필수서류": [
      { text: "▸||통합판단조사표||", depth: 0 },
      { text: "▸||가정폭력피해자권리및지원안내서||", depth: 0 },
      { text: "▸상담 지원기관 연계를 위한 ||개인정보 수집 이용 및 제3자 제공동의서||", depth: 0 },
      { text: "▸||응급조치 보고서||", depth: 0 },
      { text: "▸||긴급임시조치 결정서||", depth: 0 },
      { text: "▸||긴급임시조치 확인서||(|||가해자 교부|||) 및 ||통보서||", depth: 0 },
      { text: "▸||체포서|| or ||동행보고서|| or ||발생보고서||", depth: 0 },
    ],
    "유의사항": [
      { text: "?", depth: 0 },
      { text: "?", depth: 1 },
      { text: "?", depth: 1 }
    ]
  },

  "스토킹": {
    "현장출동": [
      { text: "□ 제지, 경고 및 분리", depth: 0 },
      { text: "□ ||스토킹 행위||란 상대방의 |의사|(|||x명시적 의사x|||)에 반하여 ||정당한 이유 없이|| 다음 어는 하나의 행위를 행하여<br> 상대방에게 ||불안감|| 또는 ||공포심||을 일으키는 것", depth: 0 },
      { text: "- |반의사불벌죄 아님|", depth: 2 },
      { text: "▸ 상대방등에게 ||접근||하거나 ||따라다니||거나 ||진로를 막아||서는 행위", depth: 1 },
      { text: "▸ 상대방등의 |주거등(일상적으로 생활하는 장소) 또는 그 부근|에서 ||기다리||거나 ||지켜보||는 행위", depth: 1 },
      { text: "▸ 상대방등에게 |||정보통신망을 이용|||하여 ||물건등||을 ||도달||하게 하거나 |나타나게| 하는 행위", depth: 1 },
      { text: "- 나타나게 하는 행위: 부재중 전화", depth: 2 },
      { text: "▸ 상대방등에게 ||직접|| 또는 ||제3자||를 통하여 ||물건등||을 ||도달||하게 하거나 ||주거등 또는 그 부근||에 ||물건등을 두||는 행위", depth: 1 },
      { text: "- 물건등 에는 제한이 없다: 층간소음", depth: 2 },
      { text: "▸ 상대방등의 정보(개인정보, 위치정보, 정보주체를 식별할 수 있을 정도의 가공한 정보)를 ||정보통신망을 이용||하여 |제3자|에게 |제공, 배포, 게시|하는 행위", depth: 1 },
      { text: "▸ ||정보통신망을 이용||하여 자신이 ||상대방등인 것처럼 가장||하는 행위", depth: 1 },
      { text: "□ 증거 확보", depth: 0 },
      { text: "□ ||통합판단조사표 작성||", depth: 0 }
    ],
     "응급조치(||경찰||)": [
      { text: "□ 진행 중인 스토킹행위에 대하여 다음 각 호의 조치를 하여야 한다", depth: 0 },
      { text: "▸1호: 스토킹행위의 ||제지||, 향후 스토킹행위의 중단 통보 및 스토킹행위를 지속적 또는 반복적으로 할 경우 |서면경고(경고장)|", depth: 1 },
      { text: "▸2호: 스토킹행위자와 피해자등의 ||분리 및 범죄수사||", depth: 1 },
      { text: "▸3호: 피해자등에 대한 ||긴급응급조치 및 잠정조치 요청의 절차 등 안내||", depth: 1 },
      { text: "▸4호: 스토킹 피해 관련 ||상담소 또는 보호시설로의 피해자등 인도||(|피해자등이 동의한 경우|만 해당한다)", depth: 1 },
      { text: "□ ||응급조치 보고서 작성||", depth: 0 },
      { text: "□ |사후신청| ||의무|| |없음|", depth: 0 },  
    ],
    "긴급응급조치(||경찰||)": [
      { text: "□ 스토킹행위가 지속적 또는 반복적으로 행하여질 우려가 있고 스토킹범죄의 예방을 위하여 긴급을 요하는 경우<br> 스토킹행위자에게 ||직권||으로 또는 스토킹행위의 상대방이나 그 법정대리인 또는 스토킹행위를 신고한 사람의 ||요청||에 의하여", depth: 0 },
      { text: "▸1호: 스토킹행위의상대방등이나 그 주거등으로부터 100미터 이내의 ||접근 금지||", depth: 1 },
      { text: "▸2호: 스토킹행위의상대방등에 대한 「전기통신기본법」 제2조제1호의 ||전기통신을 이용한 접근 금지||", depth: 1 },
      { text: "□ ||긴급응급조치결정서 작성||(|사법경찰관|)", depth: 0 },
      { text: "▸||긴급응급조치 고지서||(긴급응급조치 |대상자에게 배부|)", depth: 1 },
      { text: "▸||확인서||(수사서류 첨부, 날인거부시 수사보고)", depth: 1 },
      { text: "※긴급응급조치의 내용 및 불복 방법 등 고지(고지서 및 확인서에 포함)", depth: 2 },
      { text: "※행위자에게 고지서를 직접 교부하지 못한 경우에는 확인서 및 고지서(1page)를 첨부(상대방이 현장에 없을 경우 휴대폰 메세지, 등기 등을 이용하고 수사기록 유지)", depth: 2 },
      { text: "▸||긴급응급조치 통지||(스토킹행위의 상대방등에게 통지, |행위자의 주민등록번호등 민감한 개인정보는비식별처리|)", depth: 1 },   
      { text: "▸||피해자권리고지 안내서 배부||", depth: 1 },
      { text: "□ 긴급응급조치 |위반시|", depth: 0 },
      { text: "▸1년 이하의 ||징역|| 또는 1천만원 이하의 ||벌금||, 스토킹범죄의 처벌 등에 관한 법률 제20조 제3항", depth: 1 },

      { text: "□ |사후승인| ||의무|| |있음|(여청수사)", depth: 0 },
      { text: "▸||긴급응급조치를 하였을 때||에는 |지체 없이| 검사에게 해당 긴급응급조치에 대한 사후승인을 지방법원 판사에게 청구하여 줄 것을 |신청|해야한다.", depth: 1 },
      { text: "□ 긴급응급조치 취소(여청수사)", depth: 0 },
      { text: "▸||검사가 판사에게 긴급응급조치 사후 승인을 청구하지 아니||하거나 ||판사가 사후승인을 하지 아니한때|| |즉시| 긴급응조치를 |취소|해야 한다 ", depth: 1 },
    ],
     "잠정조치 신청(||경찰||)": [
      { text: "▸사법경찰관이 긴급응급조치를 한 경우 잠정조치 신청", depth: 0 },
    ],
     "잠정조치 청구(||검사||)": [
      { text: "▸검사 직권 또는 사법경찰관의 신청에 따라", depth: 0 },
    ],
     "잠정조치 결정(||법원||)": [
      { text: "□ 피해자 보호를 위하여 필요하다고 인정하는 경우에는 결정으로", depth: 0 },
      { text: "▸1호: 피해자에 대한 ||스토킹범죄 중단에 관한 서면 경고||", depth: 1 },
      { text: "▸2호: 피해자 또는 그의 동거인, 가족이나 그 주거등으로부터 100미터 이내의 ||접근 금지||", depth: 1 },
      { text: "▸3호: 피해자 또는 그의 동거인, 가족에 대한 「전기통신기본법」 제2조제1호의 ||전기통신을 이용한 접근 금지||", depth: 1 },
      { text: "▸3의 2호: ||전자장치의 부착||", depth: 1 },
      { text: "▸4호: 국가경찰관서의 ||유치장 또는 구치소에의 유치||", depth: 1 },

      { text: "□ 잠정조치 |위반시|", depth: 0 },
      { text: "▸3년 이하의 ||징역|| 또는 3천만원 이하의 ||벌금||(전자장치 효용을 해한 사람)", depth: 1 },
      { text: "▸2년 이하의 ||징역|| 또는 2천만원 이하의 ||벌금||(접근금지 및 전기통신을 이용한 접근금지 위반", depth: 1 },
    ],


    "필수서류": [
      { text: "▸||통합판단조사표|| 및 ||피해자권리고지 안내서||", depth: 0 },
      { text: "▸||경고장||", depth: 0 },
      { text: "▸||응급조치 보고서||", depth: 0 },
      { text: "▸||긴급응급조치결정서||", depth: 0 },
      { text: "▸||긴급응급조치 고지서(|||대상자 교부|||)|| 및 ||확인서||", depth: 0 },
      { text: "▸||긴급응급조치 통지서||(|||피해자 교부|||)", depth: 0 },
      { text: "▸||체포서|| or ||임의동행보고서|| or ||발생보고서||", depth: 0 }
    ],
    "유의사항": [
      { text: "□ |수사를 담당하거나 관여한 경찰관|이 ||피해자를 특정하여 파악할 수 있는 정보와 사생활 누설||한 경우", depth: 0 },
      { text: "▸3년 이하 |징역| 또는 3천만원 이하 |벌금|", depth: 1 },
    ]
  },

  "교제폭력": {
    "현장출동": [
      { text: "□ 가해자 경고 및 분리", depth: 0 },
      { text: "□ 사실혼 판단 체크리스트 작성", depth: 0 },
      { text: "□ ||경고장|| 및 ||피해자권리고지안내서|| 배부", depth: 0 }
    ],
    "필수서류": [
      { text: "▸||사실혼 판단 체크리스트||", depth: 0 },
      { text: "▸||경고장||", depth: 0 },
      { text: "▸||피해자권리고지안내서||", depth: 0 },
      { text: "▸||체포서|| or ||임의동행보고서|| or ||발생보고서||", depth: 0 }

    ],
    "유의사항": [
      { text: "?", depth: 0 },
      { text: "?", depth: 1 },
      { text: "?", depth: 1 }
    ]
  }
};

/* --- 문서 매핑 로직 ---
   1) 같은 폴더에 documents.json 있으면 사용(권장)
      형식 예:
      {
        "사실혼_판단_체크리스트": "facts_unmarried_checklist.pdf",
        "통합판단조사표": "integration_form.pdf",
        ...
      }
   2) documents.json 없으면 기본 후보 파일명 목록을 자동 시도
*/
let DOC_MAP = {}; // key -> relative file path
const DEFAULT_CANDIDATES = {
  "사실혼_판단_체크리스트": [
    "사실혼판단체크리스트.pdf",
    "사실혼판단체크리스트.hwp",
    "사실혼_판단_체크리스트.docx",
    "fact_marriage_checklist.pdf",
    "fact_marriage_checklist.hwp"
  ],
  "경고장": [
    "경고장.pdf",
    "경고장.hwp",
  ],
   "가정폭력_피해자_권리_및_지원_안내서": [
    "가정폭력_피해자_권리_및_지원_안내서.pdf",
    "가정폭력피해자권리및지원안내서.hwp",
  ],
  // 필요하면 다른 문서 키에 대한 후보를 여기 추가 가능
};

async function loadDocumentsJson() {
  try {
    const r = await fetch('./documents.json', {cache: "no-cache"});
    if (!r.ok) throw new Error('no documents.json');
    const j = await r.json();
    DOC_MAP = j;
    console.log('documents.json loaded', DOC_MAP);
  } catch (e) {
    // documents.json 없으면 빈 맵 유지(후보 탐색 사용)
    console.log('documents.json not found; will try default candidates');
  }
}

/* 파일 존재 확인(같은 origin) */
async function existsFile(path) {
  try {
    const res = await fetch(path, { method: 'GET', cache: "no-cache" });
    return res.ok;
  } catch (e) {
    return false;
  }
}

/* 주어진 문서 키에 대해 실제 사용 가능한 파일 경로를 반환 */
async function resolveDocumentPath(key) {
  // 1) documents.json에 명시적 경로가 있으면 우선 사용
  if (DOC_MAP && DOC_MAP[key]) {
    const p = DOC_MAP[key];
    if (await existsFile(p)) return p;
    // 문서맵에 있으나 파일이 없으면 계속해서 후보 탐색
  }

  // 2) 후보 목록 시도
  const candidates = DEFAULT_CANDIDATES[key] || [];
  for (const c of candidates) {
    if (await existsFile(c)) return c;
  }

  // 3) 못찾음
  return null;
}

/* --- 기존 UI 렌더링 코드(대체 없이 동일) --- */
function clearSubContents() {
  document.querySelectorAll('.sub-content').forEach(el => el.remove());
}

function createSubContentDepth(사건, 항목) {
  const 내용Div = document.createElement('div');
  내용Div.className = 'sub-content';
  const ul = document.createElement('ul');

  const 항목내용 = 세부내용Depth[사건]?.[항목] || [];
  항목내용.forEach(item => {
    const li = document.createElement('li');
    li.style.paddingLeft = `${item.depth * 20}px`; // depth에 따라 들여쓰기

    // 텍스트 변환
    const rawHtml = 색상변환(item.text);

    // Special: '사실혼 판단 체크리스트'가 포함된 항목이면 클릭 가능한 링크로 변환
    // (또는 '사실혼' 키워드 포함 시에도 동작)
    if (/사실혼\s*판단\s*체크리스트|사실혼|경고장|피해자권리고지안내서|통합판단조사표/.test(item.text)) {
      const a = document.createElement('a');
      a.href = "javascript:void(0)";
      a.innerHTML = rawHtml;
      a.style.textDecoration = 'underline';
      a.style.cursor = 'pointer';

      a.addEventListener('click', async (e) => {
        let docKey = "";
        let title = "";

        if (/사실혼/.test(item.text)) {
          docKey = "사실혼_판단_체크리스트";
          title = "사실혼 판단 체크리스트";
        } else if (/경고장/.test(item.text)) {
          docKey = "경고장";
          title = "경고장";
        } else if (/피해자권리고지안내서/.test(item.text)) {
          docKey = "피해자권리고지안내서";
          title = "피해자 권리 고지 안내서";
        } else if (/통합판단조사표/.test(item.text)) {
          docKey = "통합판단조사표";
          title = "통합 판단 조사표";
        } else if (/가정폭력_피해자_권리_및_지원_안내서/.test(item.text)) {
          docKey = "가정폭력_피해자_권리_및_지원_안내서";
          title = "가정폭력 피해자 권리 및 지원 안내서";
        }

        if (docKey) await openDocumentModal(docKey, title);
      });

      li.appendChild(a);
    } else {
      li.innerHTML = rawHtml;
    }

    ul.appendChild(li);
  });

  내용Div.appendChild(ul);
  return 내용Div;
}

/* --- 사건 선택 및 버튼 생성 (원본대로) --- */
let currentEvent = null;

document.querySelectorAll('input[name="사건"]').forEach(radio => {
  radio.addEventListener('change', () => {
    const 사건 = radio.value;
    currentEvent = 사건;
    const 세부버튼영역 = document.getElementById('세부항목버튼영역');
    세부버튼영역.innerHTML = '';
    const 항목들 = Object.keys(세부내용Depth[사건])
                     .filter(항목 => 항목 !== "필수서류" && 항목 !== "유의사항");
    항목들.forEach(항목 => {
      const btn = document.createElement('button');
      btn.innerHTML = 색상변환(항목);
      btn.addEventListener('click', () => {
        clearSubContents();
        const 내용 = createSubContentDepth(사건, 항목);
        btn.insertAdjacentElement('afterend', 내용);
      });
      세부버튼영역.appendChild(btn);
    });
    document.getElementById('세부항목섹션').classList.remove('hidden');
  });
});

document.querySelectorAll('#필수서류버튼영역 button').forEach(btn => {
  btn.addEventListener('click', () => {
    if (!currentEvent) { alert("먼저 사건을 선택해주세요."); return; }
    clearSubContents();
    const 내용 = createSubContentDepth(currentEvent, btn.dataset.항목); // btn의 data-항목 값으로 선택
    btn.insertAdjacentElement('afterend', 내용);
  });
});

/* --- 문서 모달 관련 함수 --- */
const modal = document.getElementById('docModal');
const docTitle = document.getElementById('docTitle');
const docContent = document.getElementById('docContent');
const docNotice = document.getElementById('docNotice');
const docDownload = document.getElementById('docDownload');
const docClose = document.getElementById('docClose');

docClose.addEventListener('click', closeDocumentModal);
modal.addEventListener('click', (e) => {
  if (e.target === modal) closeDocumentModal();
});

function openDocumentModal(docKey, friendlyName) {
  return (async () => {
    docTitle.textContent = friendlyName || docKey;
    docContent.innerHTML = '';
    docContent.appendChild(docNotice);
    docNotice.textContent = '문서를 찾는 중입니다...';
    docNotice.style.display = 'block';
    modal.classList.add('open');
    modal.setAttribute('aria-hidden', 'false');

    // Resolve document path (문서가 있으면 path 반환, 없으면 null)
    const path = await resolveDocumentPath(docKey);
    if (!path) {
      docNotice.textContent = '파일이 존재하지 않습니다. 해당 문서를 같은 폴더에 업로드하시거나 documents.json에 경로를 등록해 주세요.';
      docDownload.href = '#';
      docDownload.style.display = 'none';
      return;
    }

    // 파일이 존재하면 확장자별 처리 (pdf -> iframe/embed, hwp/docx -> 다운로드)
    const ext = path.split('.').pop().toLowerCase();
    docDownload.href = path;
    docDownload.style.display = 'inline-block';
    docDownload.setAttribute('download', '');

    if (ext === 'pdf') {
      // PDF 미리보기
      docContent.innerHTML = '';
      const embed = document.createElement('embed');
      embed.type = 'application/pdf';
      embed.src = path;
      embed.onload = () => { /* 로드됨 */ };
      docContent.appendChild(embed);
    } else if (ext === 'hwp' || ext === 'hwpx') {
      // 브라우저에서 미리보기 불가: 안내 + 다운로드
      docContent.innerHTML = '';
      const p = document.createElement('div');
      p.className = 'notice';
      p.innerHTML = '이 파일은 한글(HWP) 형식입니다. 브라우저에서 미리보기할 수 없습니다. 아래 "다운로드" 버튼을 눌러 파일을 열어주세요.';
      docContent.appendChild(p);
    } else {
      // 기타 문서 (docx 등) — 안내 및 다운로드
      docContent.innerHTML = '';
      const p = document.createElement('div');
      p.className = 'notice';
      p.innerHTML = '브라우저에서 미리보기가 지원되지 않는 파일 형식입니다. 아래 "다운로드" 버튼을 눌러 파일을 열어주세요.';
      docContent.appendChild(p);
    }
  })();
}

function closeDocumentModal() {
  modal.classList.remove('open');
  modal.setAttribute('aria-hidden', 'true');
}

/* --- 초기화: documents.json 로드 시도 --- */
loadDocumentsJson();
</script>

</body>
</html>








